<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartClass | All Courses</title>

  <!-- Vue.js -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- CSS (your external files) -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="course.css">

  <style>
    /* small UI + toast styles */
    .cart-badge {
      background: #ff3b2f;
      color: #fff;
      border-radius: 50%;
      padding: 3px 8px;
      font-size: 12px;
      margin-left: 6px;
      font-weight: 700;
      vertical-align: middle;
    }
    .search-meta {
      max-width: 1200px;
      margin: 0 auto 12px;
      padding: 0 20px;
      color: #444;
      font-weight: 600;
    }
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #4c51bf;
      color: white;
      padding: 14px 20px;
      border-radius: 8px;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.4s ease;
      z-index: 2000;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.error { background: #ff3b2f; }

    .no-course { text-align:center; font-size:18px; padding:40px; color:#555; }

    /* overlay styling fallback if your CSS doesn't cover it */
    .course-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:18px; max-width:1200px; margin:20px auto; padding:0 20px; }
    .course-card { background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 6px 18px rgba(12,12,12,0.05); position:relative; display:flex; flex-direction:column; }
    .course-card img { width:100%; height:160px; object-fit:cover; display:block; }
    .course-card .info { padding:14px; flex:1 1 auto; }
    .course-card h3 { margin:0 0 6px; font-size:16px; color:#222; }
    .instructor { font-size:13px; color:#666; margin-bottom:8px; }
    .rating-box { font-weight:600; color:#444; font-size:13px; margin-bottom:8px; }
    .price { font-weight:800; color:#4c51bf; margin-bottom:6px; }
    .course-extra { font-size:13px; color:#666; margin-top:6px; line-height:1.3; }

    .overlay { padding:12px 14px 18px; border-top:1px solid #f0f0f0; background:#fafafa; display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .overlay .overlay-left { max-width:70%; }
    .overlay .overlay-left h4 { margin:0 0 6px; font-size:15px; }
    .overlay .details-list { margin:0 0 6px; padding-left:18px; color:#444; font-size:13px;}
    .overlay .overlay-bottom { display:flex; align-items:center; gap:10px; }
    .overlay .overlay-price { font-weight:800; color:#4c51bf; }
    .btn-cart { background:#667eea; color:#fff; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }
    .btn-cart[disabled] { background:#ccc; cursor:not-allowed; }

    /* toolbar */
    .courses-header-bar { max-width:1200px; margin:20px auto; padding:0 20px; }
    .filter-toolbar { display:flex; align-items:center; justify-content:space-between; gap:12px; background:#f8f9fb; padding:12px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.04); }
    .left-controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .right-controls { display:flex; gap:8px; align-items:center; }
    .filter-select, .search-input, .search-btn, .clear-btn { font-size:14px; padding:9px 12px; border-radius:6px; border:1px solid #dcdfe6; outline:none; }
    .filter-select { min-width:160px; background:#fff; }
    .search-input { width:260px; border-top-right-radius:0; border-bottom-right-radius:0; }
    .search-btn { background:#4c51bf; color:#fff; border-top-left-radius:0; border-bottom-left-radius:0; cursor:pointer; }
    .clear-btn { background:#ff3b2f; color:#fff; border:none; cursor:pointer; padding:9px 12px; border-radius:6px; }

    /* Categories-dropdown panel */
    .cat-btn { background:#fff; border:1px solid #dcdfe6; padding:9px 12px; border-radius:6px; cursor:pointer; display:flex; align-items:center; gap:8px; }
    .cat-panel { position:absolute; background:#fff; box-shadow:0 6px 18px rgba(0,0,0,0.08); border-radius:8px; padding:12px; width:340px; z-index:80; margin-top:6px; }
    .cat-panel .row { display:flex; gap:8px; margin-bottom:8px; align-items:center; }
    .cat-panel label { font-size:13px; min-width:90px; color:#444; }
    .cat-panel select { flex:1; padding:8px; border-radius:6px; border:1px solid #e6e6ea; }

    /* responsive */
    @media (max-width:900px) { .filter-toolbar{flex-direction:column;align-items:stretch;} .search-input{width:100%;} .cat-panel{width:100%; position:static; box-shadow:none;} }
  </style>
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="navbar">
      <div class="container">
        <div class="logo"><a href="index.html">SmartClass</a></div>
        <nav>
          <ul class="nav-list">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li><a href="course.html" class="nav-link active">Courses</a></li>
            <li>
              <a href="cart.html" class="signup-btn" @click.prevent="goToCart">
                <i class="fas fa-shopping-cart"></i> Cart
                <span v-if="cartTotalItems > 0" class="cart-badge">{{ cartTotalItems }}</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Page Title -->
    <section class="page-banner">
      <h1>Explore All Courses</h1>
      <p>Browse our complete collection of high-quality learning programs designed for your growth.</p>
    </section>

    <!-- Filter & Search Bar -->
    <section class="courses-header-bar">
      <div class="filter-toolbar" role="toolbar" aria-label="Course filters" style="position:relative;">
        <div class="left-controls">
          <!-- Categories button which opens the panel -->
          <div style="position:relative;">
            <button class="cat-btn" @click="toggleCatPanel" :aria-expanded="catPanelOpen">
              <i class="fas fa-filter"></i> Categories
              <i :class="['fas', catPanelOpen ? 'fa-chevron-up' : 'fa-chevron-down']" style="margin-left:auto;"></i>
            </button>

            <!-- The panel that appears when Categories clicked -->
            <div v-if="catPanelOpen" class="cat-panel" @click.stop>
              <div class="row">
                <label>Category</label>
                <select v-model="selectedCategory">
                  <option value="">All Categories</option>
                  <option v-for="cat in categories" :key="cat">{{ cat }}</option>
                </select>
              </div>

              <div class="row">
                <label>Availability</label>
                <select v-model="selectedAvailability">
                  <option value="">All</option>
                  <option value="available">Available</option>
                  <option value="unavailable">Unavailable</option>
                </select>
              </div>

              <div class="row">
                <label>Price</label>
                <select v-model="selectedPriceSort">
                  <option value="">None</option>
                  <option value="priceLow">Low ‚Üí High</option>
                  <option value="priceHigh">High ‚Üí Low</option>
                </select>
              </div>

              <div class="row">
                <label>Rating</label>
                <select v-model="selectedRatingSort">
                  <option value="">None</option>
                  <option value="ratingDesc">Top Rated</option>
                </select>
              </div>

              <div class="row">
                <label>Location</label>
                <select v-model="selectedLocation">
                  <option value="">All Locations</option>
                  <option v-for="loc in locations" :key="loc">{{ loc }}</option>
                </select>
              </div>

              <div style="display:flex; gap:8px; margin-top:8px; justify-content:flex-end;">
                <button class="clear-btn" @click="clearCatPanel">Reset</button>
                <button class="search-btn" @click="closeCatPanel">Apply</button>
              </div>
            </div>
          </div>

          <!-- (Optional) quick sort select kept visible -->
          <select v-model="selectedSort" class="filter-select" aria-label="Sort courses">
            <option value="">Sort By</option>
            <option value="rating">Best Rating</option>
            <option value="priceLow">Price: Low to High</option>
            <option value="priceHigh">Price: High to Low</option>
          </select>
        </div>

        <div class="right-controls">
          <div style="display:flex;align-items:center;">
            <input class="search-input" type="text" placeholder="Search for a course..." v-model="searchQuery" @keyup.enter="searchCourses" aria-label="Search courses">
            <button class="search-btn" @click="searchCourses" aria-label="Search">Search</button>
          </div>
          <button class="clear-btn" @click="clearFilters" aria-label="Clear filters">Clear</button>
        </div>
      </div>
    </section>

    <!-- Search Result Info -->
    <div v-if="searchQuery.trim() !== ''" class="search-meta">
      Showing {{ filteredCourses.length }} result<span v-if="filteredCourses.length !== 1">s</span> for "<strong>{{ searchQuery }}</strong>"
    </div>

    <!-- All Courses -->
    <section class="courses" id="courses">
      <div v-if="filteredCourses.length === 0" class="no-course">
        ‚ùå No courses found for "<strong>{{ searchQuery }}</strong>"
      </div>

      <div v-else class="course-grid">
        <div class="course-card" v-for="course in filteredCourses" :key="course.id">
          <img :src="course.image" :alt="course.title">
          <div class="info">
            <h3>{{ course.title }}</h3>
            <p class="instructor">{{ course.category }} ‚Ä¢ {{ course.instructor }}</p>
            <div class="rating-box">
              <span class="star">‚òÖ</span> {{ course.rating }}
              <span class="review-count"> ({{ course.reviews }} ratings)</span>
            </div>
            <div class="price">${{ formatPrice(course.price) }}</div>

            <p class="course-extra">
              üìç {{ course.location }}<br>
              üßæ Available: <strong>{{ course.available }}</strong>
            </p>
          </div>

          <!-- overlay with full details -->
          <div class="overlay" role="region" aria-label="Course details">
            <div class="overlay-left">
              <h4>{{ course.title }}</h4>
              <p style="margin:6px 0; font-size:13px; color:#444;"><strong>Bestseller</strong> ‚Ä¢ Updated Oct 2025</p>
              <p style="margin:4px 0; font-size:13px; color:#444;">2h ‚Ä¢ All Levels ‚Ä¢ Subtitles</p>

              <ul class="details-list">
                <li v-for="(d, i) in course.details" :key="i">{{ d }}</li>
              </ul>

              <p style="margin:6px 0; font-size:13px; color:#666;">
                <strong>Location:</strong> {{ course.location }} &nbsp; ‚Ä¢ &nbsp;
                <strong>Available:</strong> {{ course.available }}
              </p>
            </div>

            <div class="overlay-bottom">
              <span class="overlay-price">${{ formatPrice(course.price) }}</span>
              <button class="btn-cart" @click="addToCart(course)" :disabled="isAtMax(course)">
                <span v-if="!isAtMax(course)">Add to Cart</span>
                <span v-else>Sold Out</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Toast -->
    <div v-if="toastMessage" :class="['toast', toastType, { show: showToast }]" role="status">
      {{ toastMessage }}
    </div>

    <!-- Footer -->
    <footer>
      &copy; 2025 SmartClass. All rights reserved.
    </footer>
  </div>

 <script>
  new Vue({
    el: "#app",
    data: {
      courses: [],
      filteredCourses: [],
      searchQuery: "",
      selectedCategory: "",
      selectedSort: "",
      categories: []
    },

    mounted() {
      // Fetch courses from backend
      fetch("http://localhost:5000/api/courses")
        .then(res => res.json())
        .then(data => {
          this.courses = data;
          this.filteredCourses = data;

          // Auto-generate unique categories
          this.categories = [...new Set(data.map(c => c.category))];
        })
        .catch(err => console.error("Error loading courses:", err));
    },

    methods: {
      filterCourses() {
        let list = this.courses;

        // Search filter
        if (this.searchQuery.trim() !== "") {
          const q = this.searchQuery.toLowerCase();
          list = list.filter(c =>
            c.title.toLowerCase().includes(q) ||
            c.instructor.toLowerCase().includes(q)
          );
        }

        // Category filter
        if (this.selectedCategory !== "") {
          list = list.filter(c => c.category === this.selectedCategory);
        }

        // Sorting filter
        if (this.selectedSort === "priceAsc") {
          list = list.sort((a, b) => a.price - b.price);
        } else if (this.selectedSort === "priceDesc") {
          list = list.sort((a, b) => b.price - a.price);
        } else if (this.selectedSort === "rating") {
          list = list.sort((a, b) => b.rating - a.rating);
        }

        this.filteredCourses = list;
      },

      addToCart(course) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart.push(course);
        localStorage.setItem("cart", JSON.stringify(cart));
        alert("Course added to cart!");
      }
    },

    watch: {
      searchQuery() { this.filterCourses(); },
      selectedCategory() { this.filterCourses(); },
      selectedSort() { this.filterCourses(); }
    }
  });
</script>

</body>
</html>
